















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2020-09-23 19:13:20 -0600">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    <link rel="license" href="#license-info" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - Working with Climate Data"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Subsetting Data &ndash; Working with Climate Data
  </title>  

  </head>
  <body>

    







    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/swc-icon-blue.svg" alt="Software Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-intro/index.html">Getting and Reading Data for Today's Class</a></li>
            
            
            <li><a href="../02-subsetting/index.html">Subsetting Data</a></li>
            
            
            <li><a href="../03-aggregating/index.html">Aggregating Data</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            <li><a href="../about/index.html">About</a></li>
            
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit//_episodes/02-subsetting.md" data-checker-ignore>Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>




























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../01-intro/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Working with Climate Data</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../03-aggregating/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Subsetting Data</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 0 min
      <br/>
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How do I extract a particular region from my data?</p>
</li>
	
	<li><p>How do I extract a specific time slice from my data?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h3 id="subsetting-data-in-space">Subsetting data in Space</h3>

<p>Often in our research, we want to look at a specific region defined by a set of latitudes and longitudes.</p>

<h4 id="conventional-approach">Conventional approach</h4>
<p>We would have an array, like an <code class="language-plaintext highlighter-rouge">numpy.ndarray</code> with 3 dimensions, such as lat,lon,time that contains our data. We would need to write nested loops with <code class="language-plaintext highlighter-rouge">if</code> statements to find the indices of the latitudes and longitudes we are looking for and then extract out those data to a new array.</p>

<p>This is slow, and has the potential for mistakes if we get the wrong indices. Our data and metadata are disconnected.</p>

<p><code class="language-plaintext highlighter-rouge">xarray</code> makes it possible for us to keep our data and metadata connected and select data based on the dimensions, so we can tell it to extract a specific lat-lon point or select a specific range of lats and lons using teh <code class="language-plaintext highlighter-rouge">sel</code> function.</p>

<h3 id="select-a-point">Select a point</h3>

<p>Let’s try it for a point.  We will pick a latitude and longitude in the middle of the Pacific Ocean.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds_point</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s">'nearest'</span><span class="p">)</span>
<span class="n">ds_point</span>
</code></pre></div></div>

<p>We now have a new <code class="language-plaintext highlighter-rouge">xarray.Dataset</code> with all the times and a single latitude and longitude point. All the metadata is carried around with our new <code class="language-plaintext highlighter-rouge">Dataset</code>.  We can plot this timeseries and label the x-axis with the time information.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ds_point</span><span class="p">[</span><span class="s">'time'</span><span class="p">],</span><span class="n">ds_point</span><span class="p">[</span><span class="s">'sst'</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="select-a-region">Select a Region</h3>

<p>A common region to look at SSTs is the Nino3.4 region.  It is defined as 5S-5N; 170W-120W.</p>

<p><img src="../fig/ninoareas_c.jpg" alt="Nino Region" /></p>

<p>Our longitudes are defined by 0 to 360 (as opposed to -180 to 180), so we need to specify our longitudes consitent with that.  To select a region we use the <code class="language-plaintext highlighter-rouge">sel</code> command with <code class="language-plaintext highlighter-rouge">slice</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds_nino34</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">360</span><span class="o">-</span><span class="mi">170</span><span class="p">,</span><span class="mi">360</span><span class="o">-</span><span class="mi">120</span><span class="p">),</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ds_nino34</span>
</code></pre></div></div>

<p>Notice that we have no latitudes, what happened?
Our data has latitudes going from North to South, but we sliced from South to North.  This results in <code class="language-plaintext highlighter-rouge">sel</code> finding no latitudes in the range.  There are two options to fix this: (1) we can slice in the direction of the latitudes `lat=slice(5,-5)) or (2) we can reverse the latitudes to go from South to North.  Let’s reverse the latitudes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s">'lat'</span><span class="p">])))</span>
</code></pre></div></div>

<p>This line reverses the latitudes and then tells <code class="language-plaintext highlighter-rouge">xarray</code> to put them back into the latitude coordinate.  But, since <code class="language-plaintext highlighter-rouge">xarray</code> keeps our metadata attached to our data, we can’t just reverse the latitudes without telling <code class="language-plaintext highlighter-rouge">xarray</code> that we want it to attach the reversed latitudes to our data instead of the original latitudes. That’s what the <code class="language-plaintext highlighter-rouge">reindex</code> function does.</p>

<p>Now we can slice our data from 5S to 5N</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds_nino34</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">360</span><span class="o">-</span><span class="mi">170</span><span class="p">,</span><span class="mi">360</span><span class="o">-</span><span class="mi">120</span><span class="p">),</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ds_nino34</span>
</code></pre></div></div>

<p>Now, let’s plot our data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ds_nino34</span><span class="p">[</span><span class="s">'lon'</span><span class="p">],</span><span class="n">ds_nino34</span><span class="p">[</span><span class="s">'lat'</span><span class="p">],</span>
             <span class="n">ds_nino34</span><span class="p">[</span><span class="s">'sst'</span><span class="p">][</span><span class="mi">0</span><span class="p">,:,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s">'RdBu_r'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="time-slicing">Time Slicing</h3>

<p>Sometimes we want to get a particular time slice from our data.  Perhaps we have two datasets and we want to select the time slice that is common to both.  In this dataset, the data start in Dec 1981 and end in Apr 2020.  Suppose we want to extract the times for which we have full years (e.g, Jan 1982 to Dec 2019.  We can use the <code class="language-plaintext highlighter-rouge">sel</code> function to also select time slices. Let’s select only these times for our <code class="language-plaintext highlighter-rouge">ds_nino34</code> dataset.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds_nino34</span><span class="o">=</span><span class="n">ds_nino34</span><span class="p">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s">'1982-01-01'</span><span class="p">,</span><span class="s">'2019-12-01'</span><span class="p">))</span>
<span class="n">ds_nino34</span>
</code></pre></div></div>

<blockquote class="callout">
  <h2 id="writing-data-to-a-file">Writing data to a file</h2>

  <p>In this case the dataset is small, but saving off our intermediate datasets is a common step
in climate data analysis.  This is because our datasets can be very large so we may not
want to wait for all our analysis steps to run each time we want to work with this data.
We can write out our intermediate data to a file for future use.</p>

  <p>It is easy to write an <code class="language-plaintext highlighter-rouge">xarray.Dataset</code> to a netcdf file using the <code class="language-plaintext highlighter-rouge">to_netcdf()</code> function.</p>

  <p>Write out the ds_nino34 dataset to a file in your /scratch directory, like this (replace my username with yours):</p>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ds_nino34</span><span class="p">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s">'/scratch/kpegion/nino34_1982-2019.oisstv2.nc'</span><span class="p">)</span>
</code></pre></div>  </div>

  <p>Bring up a terminal window in Jupyter and convince yourself that the file was written and the metatdata 
is what you expect by using ncdump</p>

</blockquote>






<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li>
</li>
    
  </ul>
</blockquote>

</article>



























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../01-intro/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../03-aggregating/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      






<footer>
  <div class="row">
    <div class="col-md-6 license" id="license-info" align="left">
	
	Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2018–2020
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a> 2016–2018
	by <a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit//_episodes/02-subsetting.md" data-checker-ignore>Edit on GitHub</a>
	
	/
	<a href="/blob//CONTRIBUTING.md" data-checker-ignore>Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob//CITATION" data-checker-ignore>Cite</a>
	/
	<a href="mailto:team@carpentries.org">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
